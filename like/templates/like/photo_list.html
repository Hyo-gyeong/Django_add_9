{% extends 'like_base.html' %}
{% load static %}
{% block content %}
<head>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.js"
      integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css">
  <style>
    .heart {
      width:20px;
      height:20px;
    }
    .flex_item{
      margin-top: 40px;
      max-width: 400px;
    }
    button{
      padding: 0;
      border: none;
      background: none;
    }
    a{
      color:darkblue
    }
    .card-title, .text-muted{
      font-size: 10px;
      color:darkgray;
    }
    .card-title{
      float: right;
    }
    img{
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
  </style>
</head>

{% for post in object_list %}
<div class="flex_item">
  <img src="{{ post.image.url }}"alt="..."><br>
  <small class="card-title">{{ post.author }}ë‹˜ì˜ ê²Œì‹œê¸€</small><br>
    <p class="card-text">{{ post.text }}</p>
  <div class="card-body">
    <a href="{% url 'like:detail' post.id %}" class="card-link">ğŸ’¬</a>
    {% if user == post.author %}
    <a href="{% url 'like:update' post.id %}" class="card-link">ìˆ˜ì •</a>
    <a href="{% url 'like:delete' post.id %}" class="card-link">ì‚­ì œ</a>
    {% endif %}    
    <a href="{% url 'like:detail' post.id %}" class="card-link">ìì„¸íˆ</a>
  {% if user.is_authenticated %}
  <button id="{{post.id}}" onclick="post_like(this.id)">
    {%if request.user in post.like.all%}
    <!-- ë¡œê·¸ì¸ í•œ ìœ ì €ê°€ ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥¸ ìœ ì €ì¼ë•Œ  -->
    <img class="heart" id="heart{{post.id}}" src="{% static 'heart.png' %}" alt="full_heart">
    {%else%}
    <!-- ë¡œê·¸ì¸ í•œ ìœ ì €ê°€ ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥¸ ìœ ì €ê°€ ì•„ë‹ ë•Œ  -->
    <img class="heart" id="heart{{post.id}}" src="{% static 'empty_heart.png' %}" alt="empty_heart">
    {%endif%}
  </button>
  {% else %}
  <button id="{{post.id}}" onclick="alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤')">
    <img class="heart" id="heart" src="{% static 'empty_heart.png' %}" alt="empty_heart">
  </button>
  {% endif %} 
  <span id="like_count{{post.id}}">{{post.like.count}}</span>
  <br>
  <small class="text-muted">ìƒì„±ì¼ : {{ post.created }}</small><br>
  <small class="text-muted">ìˆ˜ì •ì¼ : {{ post.updated }}</small><br>
  </div> 
</div>
  {% endfor %}  
<script type="text/javascript">
  function post_like(p_id) {
    $.ajax({
      type: "GET",
      url: "{% url 'like:post_likes' %}", // dataë¥¼ ì „ì†¡í•  url ì…ë‹ˆë‹¤.
      data: {
        'blog_id': p_id
      }, // post_id ë¼ëŠ” nameìœ¼ë¡œ id ê°’ ì „ì†¡
      dataType: "json",
      success: function (response) { // ajax í†µì‹ ì´ ì •ìƒì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆì„ ë•Œ
        $('#like_count'+p_id).html(response.like_count) //idê°€ like_countì˜ ë‚´ìš©ì„ ì „ì†¡ë°›ì€ ì¢‹ì•„ìš” ìˆ˜ë¡œ ë°”ê¾¼ë‹¤
        //$('#message').html(response.message) //idê°€ messageì˜ ë‚´ìš©ì„ ì „ì†¡ë°›ì€ messageë¡œ ë°”ê¾¼ë‹¤
        //$('.toast').fadeIn(400).delay(100).fadeOut(400)
          if (response.message == "ì¢‹ì•„ìš”")
        //ì¢‹ì•„ìš” ëˆŒë €ì„ ë•Œ 
        {
          $('#heart'+p_id).attr("src", "{% static 'heart.png' %}")
        } else if (response.message == "ì¢‹ì•„ìš” ì·¨ì†Œ")
        //ì¢‹ì•„ìš” ìƒíƒœì—ì„œ ë‹¤ì‹œ ëˆŒë €ì„ ë•Œ 
        {
          $('#heart'+p_id).attr("src", "{% static 'empty_heart.png' %}")
        }
      }
    })
  }
  </script>
{% endblock %}
